# YOLOv8_X_ray
- åŸºäºYOLOv8çš„X-rayå±é™©å“æ£€æµ‹ç³»ç»Ÿï¼Œ
- **å¦‚æœå¯¹ä½ æœ‰å¸®åŠ©çš„è¯è¯·åœ¨å³ä¸Šè§’â†—ï¸ç‚¹ä¸ªå°å°çš„startâ­è°¢è°¢ğŸ˜˜ğŸ’•**
# YOLOv8_X-rayå±é™©å“æ£€æµ‹ç³»ç»Ÿè¯¦è§£

## ä¸€ã€é¡¹ç›®æ¶æ„å…¨æ™¯å›¾

YOLOv8_X-rayå±é™©å“æ£€æµ‹ç³»ç»ŸåŒ…å«ä»¥ä¸‹ä¸»è¦æ¨¡å—ï¼š

- **æ•°æ®å‡†å¤‡**
  - data_processing.py (æ•°æ®æ ¼å¼è½¬æ¢)
  - yolo_dataset/
    - images/ (æ ‡å‡†åŒ–æ•°æ®é›†ã€è®­ç»ƒ/æµ‹è¯•å›¾åƒ)
    - labels/ (æ ‡æ³¨æ–‡ä»¶)

- **æ¨¡å‹è®­ç»ƒ**
  - train.py (è®­ç»ƒè„šæœ¬)
  - pre_train_models/ (é¢„è®­ç»ƒæƒé‡)
  - trained_model/ (è®­ç»ƒè¾“å‡º)

- **æ¨ç†éƒ¨ç½²**
  - ç¯å¢ƒä¾èµ–
    - x_ray_windows.py (PyQt5å›¾å½¢ç•Œé¢)
    - yolo11n.pt (æœ€ç»ˆéƒ¨ç½²æ¨¡å‹)
  - requirements.txt (ä¾èµ–åº“æ¸…å•)

## äºŒã€æ ¸å¿ƒæ–‡ä»¶è¯¦è§£

### æ•°æ®å¤„ç†æ¨¡å— data_processing.py

```python
# æ•°æ®é›†è·¯å¾„é…ç½®
yolo_dataset_path = r"YOLOæ ‡å‡†æ•°æ®é›†è·¯å¾„"
data_path = r"åŸå§‹æ•°æ®é›†è·¯å¾„"

# ç±»åˆ«å®šä¹‰(8ç±»å±é™©å“)
classes = [
    'Mobile_Phone', # æ‰‹æœº
    'Cosmetic', # åŒ–å¦†å“
    'Portable_Charger_1', 'Portable_Charger_2', # å……ç”µå®
    'Nonmetallic_Lighter', # éé‡‘å±æ‰“ç«æœº
    "Water', # æ¶²ä½“
    'Tablet', # å¹³æ¿ç”µè„‘
    'Laptop' # ç¬”è®°æœ¬ç”µè„‘
]

# æ ‡ç­¾æ ¼å¼è½¬æ¢(åæ ‡å½’ä¸€åŒ–)
def convert_label_format(label_path, image_width, image_height):
    # å®ç°åæ ‡è½¬æ¢é€»è¾‘:åƒç´ åæ ‡ï¿«YOLOv8å½’ä¸€åŒ–åæ ‡
    # è¿”å›æ ‡å‡†åŒ–åçš„æ ‡ç­¾æ•°æ®
```

### æ¨¡å‹è®­ç»ƒæ¨¡å— train.py

```python
# è®­ç»ƒå‚æ•°é…ç½®
train_params = {
    'data': 'yolo_dataset/xray_data.yaml', # æ•°æ®é›†é…ç½®
    'epochs': 100, # è®­ç»ƒè½®æ¬¡
    'batch': 4, # æ‰¹é‡å¤§å°(æ ¹æ®æ˜¾å­˜è°ƒæ•´)
    'imgsz': 640, # è¾“å…¥å°ºå¯¸
    'device': 'cuda', # è®¾å¤‡é€‰æ‹©
    'optimizer': 'AdamW', # ä¼˜åŒ–å™¨ç±»å‹
    'lr0': 0.001, # åˆå§‹å­¦ä¹ ç‡
    'augment': True, # æ•°æ®å¢å¼ºå¼€å…³
    'mosaic': 0.75, # é©¬èµ›å…‹å¢å¼ºæ¦‚ç‡
    'project': 'trained_models', # è¾“å‡ºç›®å½•
    'name': 'xray_detection_v1' # å®éªŒåç§°
}

# è®­ç»ƒæµç¨‹
model.train(**train_params) # å¯åŠ¨è®­ç»ƒ
model.val() # éªŒè¯é›†è¯„ä¼°
model.predict() # æ¨ç†ç¤ºä¾‹
model.export() # æ¨¡å‹å¯¼å‡º(ONNX/TensorRT)
```

### æ¨ç†éƒ¨ç½²æ¨¡å— x_ray_windows.py

```python
class DetectionUI(QWidget):
    def __init__(self):
        # åŠ è½½æ¨¡å‹
        self.model = YOLO('trained_model/weights/best.pt')
        self.initUI() # åˆå§‹åŒ–ç•Œé¢
        
    def open_image(self): # å›¾åƒåŠ è½½
        # å®ç°å›¾åƒé€‰æ‹©å¯¹è¯æ¡†
        
    def process_images(self): # å›¾åƒå¤„ç†
        results = self.model(img) # æ‰§è¡Œæ£€æµ‹
        # å¤„ç†æ£€æµ‹ç»“æœ
        for box in results[0].boxes:
            cls = results[0].names[int(box.cls)] # è·å–ç±»åˆ«
            conf = float(box.conf) # è·å–ç½®ä¿¡åº¦
            xmin, ymin, xmax, ymax = box.xyxy[0] # è·å–åæ ‡
            
    def save_results(self): # ç»“æœä¿å­˜
        # å°†æ£€æµ‹ç»“æœä¿å­˜ä¸ºExcelæ–‡ä»¶
```

## ä¸‰ã€YOLOv8å·¥ä½œåŸç†è¯¦è§£

### ç½‘ç»œæ¶æ„ç‰¹æ€§

- å•é˜¶æ®µæ£€æµ‹å™¨(Single-stage)
- ä¸»å¹²ç½‘ç»œ:CSPDarknet8
- æ£€æµ‹å¤´:Decoupled Head(è§£è€¦æ£€æµ‹å¤´)
- ç‰¹å¾é‡‘å­—å¡”:PANet(Path Aggregation Network)

### æ•°æ®å¤„ç†æµç¨‹

åŸå§‹å›¾åƒ ï¿« å¡«å……/ç¼©æ”¾ ï¿« å¢å¼ºå¤„ç† ï¿« è¾“å…¥ç½‘ç»œ ï¿« è¾“å‡º [x_center, y_center, width, height, conf, class_probs] ï¿« NMSåå¤„ç† ï¿« å¯è§†åŒ–ç»“æœ

### å…³é”®æŠ€æœ¯ç‚¹

- Anchor-freeæœºåˆ¶:ç›´æ¥é¢„æµ‹è¾¹ç•Œæ¡†åæ ‡
- åŠ¨æ€æ ‡ç­¾åˆ†é…:æ ¹æ®IoUåŠ¨æ€åŒ¹é…æ­£è´Ÿæ ·æœ¬
- ä»»åŠ¡è§£è€¦:åˆ†ç±»å’Œæ£€æµ‹åˆ†æ”¯åˆ†ç¦»
- è‡ªé€‚åº”è®­ç»ƒç­–ç•¥:æ ¹æ®è®¾å¤‡è‡ªåŠ¨è°ƒæ•´å‚æ•°

## å››ã€å¼€å‘ç¯å¢ƒé…ç½®æŒ‡å—

### ç¯å¢ƒä¾èµ–å®‰è£…

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
conda create -n x-ray python==3.10

# æ¿€æ´»ç¯å¢ƒ
conda activate x-ray

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### æ•°æ®é›†å‡†å¤‡æµç¨‹

åŸå§‹æ•°æ®é›†ç»“æ„:

- train/
  - train_image/ (è®­ç»ƒå›¾åƒ)
  - train_annotation/ (è®­ç»ƒæ ‡æ³¨)
- test/
  - test_image/ (æµ‹è¯•å›¾åƒ)
  - test_annotation/ (æµ‹è¯•æ ‡æ³¨)

```bash
# æ‰§è¡Œæ•°æ®è½¬æ¢
python data_processing.py
```

### æ¨¡å‹è®­ç»ƒæµç¨‹

```bash
# å¯åŠ¨è®­ç»ƒ
python train.py
```

è®­ç»ƒè¾“å‡ºç»“æ„:

- trained_models/
  - xray_detection_v1/
    - weights/
      - best.pt (æœ€ä½³æ¨¡å‹)
      - last.pt (æœ€ç»ˆæ¨¡å‹)
    - results.csv (è®­ç»ƒç»“æœ)

### åº”ç”¨éƒ¨ç½²æµç¨‹

```bash
# å¯åŠ¨æ£€æµ‹åº”ç”¨
python x_ray_windows.py

# æ¨¡å‹å¯¼å‡º
model.export(format='onnx') # å¯¼å‡ºONNXæ¨¡å‹
```

## äº”ã€å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

### CUDAå†…å­˜ä¸è¶³

- è°ƒæ•´train.pyä¸­çš„batch_sizeå‚æ•°
- å‡å°è¾“å…¥å°ºå¯¸imgszè‡³320-416
- å¯ç”¨æ··åˆç²¾åº¦è®­ç»ƒ--amp True

### æ£€æµ‹ç²¾åº¦ä½

- è°ƒæ•´x_ray_windows.pyä¸­çš„conf_thresholdç½®ä¿¡åº¦é˜ˆå€¼
- å¢åŠ æ•°æ®å¢å¼ºç§ç±»(æ—‹è½¬ï½¤é€è§†å˜æ¢)
- ä½¿ç”¨æ›´å¤æ‚çš„æ¨¡å‹å˜ä½“(yolov8s.pt/yolov8m.pt)

### è·¯å¾„é…ç½®é”™è¯¯

- æ£€æŸ¥data_processing.pyä¸­çš„è·¯å¾„é…ç½®
- éªŒè¯train.pyçš„data_yaml_pathæ˜¯å¦æ­£ç¡®
- ç¡®ä¿x_ray_windows.pyæ¨¡å‹è·¯å¾„æ­£ç¡®

## å…­ã€é¡¹ç›®æ‰©å±•å»ºè®®

### æ€§èƒ½ä¼˜åŒ–æ–¹å‘

- æ·»åŠ TensorRTåŠ é€Ÿæ”¯æŒ
- å®ç°å¤šçº¿ç¨‹æ•°æ®é¢„å¤„ç†
- é›†æˆOpenVINOåŠ é€Ÿæ¨ç†

### åŠŸèƒ½æ‰©å±•å»ºè®®

- æ·»åŠ è§†é¢‘æµæ£€æµ‹åŠŸèƒ½
- å®ç°æ£€æµ‹ç»“æœæ•°æ®åº“å­˜å‚¨
- å¢åŠ å¼‚å¸¸æ¨¡å¼åˆ†ææ¨¡å—

### å·¥ç¨‹æ”¹è¿›æ–¹å‘

- æ·»åŠ è®­ç»ƒå‚æ•°å¯è§†åŒ–é¢æ¿
- å®ç°è‡ªåŠ¨è¶…å‚æ•°ä¼˜åŒ–
- æ„å»ºæŒç»­é›†æˆ(CI)æµç¨‹

æœ¬æ•™ç¨‹å®Œæ•´è¦†ç›–äº†ä»ç¯å¢ƒæ­å»ºï½¤æ•°æ®é¢„å¤„ç†ï½¤æ¨¡å‹è®­ç»ƒåˆ°æœ€ç»ˆéƒ¨ç½²çš„å®Œæ•´æµç¨‹,æ¯ä¸ªæ ¸å¿ƒæ¨¡å—éƒ½æœ‰å¯¹åº”çš„ä»£ç å®ç°å’ŒåŸç†è¯´æ˜ï½¡å¯¹äºæŠ€æœ¯å°ç™½,å»ºè®®æŒ‰ç…§ä»¥ä¸‹é¡ºåºå®è·µ:

1. å…ˆè¿è¡Œå·²æä¾›çš„é¢„è®­ç»ƒæ¨¡å‹(yolo11n.pt)
2. ç†è§£æ•°æ®é¢„å¤„ç†æµç¨‹(data_processing.py)
3. å°è¯•å¾®è°ƒè®­ç»ƒ(train.py)
4. æœ€åè¿›è¡Œç•Œé¢åº”ç”¨å¼€å‘(x_ray_windows.py)
